(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-1",headers:{authorization:"a09daf17-3aa6-4f0e-82ba-81e647b9b7db","Content-Type":"application/json"}},t=function(){return fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){return e.json()})).catch((function(e){console.log(e)}))};function n(t){var n=t.target.closest(".element").id;t.target.classList.contains("element__like-button_active")?(t.target.classList.remove("element__like-button_active"),function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.json()})).catch((function(e){console.log(e)}))}(n).then((function(e){return o(n,e.likes)}))):(t.target.classList.add("element__like-button_active"),function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.json()})).catch((function(e){console.log(e)}))}(n).then((function(e){return o(n,e.likes)})))}function o(e,t){document.getElementById(e).querySelector(".element__like-count").textContent=t.length}function r(e){var t=e.querySelector(".popup__save-button");"Сохранить"===t.value?t.value="Сохранение...":t.value="Сохранить"}var c=document.querySelector(".profile__edit-button"),a=document.querySelector(".popup_edit"),u=a.querySelector(".close-button"),l=document.querySelector(".profile__add-button"),i=document.querySelector(".popup_add"),s=i.querySelector(".close-button"),d=document.querySelector(".profile__name"),p=document.querySelector(".profile__occupation"),_=a.querySelector(".popup__profile-name"),f=a.querySelector(".popup__profile-about"),m=a.querySelector(".popup__form"),v=document.querySelector(".popup_image"),h=v.querySelector(".close-button"),y=document.querySelectorAll(".popup"),S=document.querySelector(".popup__edit-avatar"),q=document.querySelector(".profile__avatar-container"),b=S.querySelector(".close-button"),L=S.querySelector(".popup__form");function k(){g(a),m.reset()}function E(e){e.classList.add("popup_opened"),document.addEventListener("keydown",A)}function g(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",A)}function C(e){var t=document.querySelector(".image-popup__image"),n=document.querySelector(".image-popup__caption");t.src=e.target.src,t.alt=e.target.alt,n.textContent=e.target.alt,E(v)}function x(e){g(e.target)}function A(e){"Escape"===e.key&&y.forEach((function(e){g(e)}))}y.forEach((function(e){e.addEventListener("click",x)}));var U=i.querySelector(".popup__form"),N=U.querySelector(".popup__add-card"),T=U.querySelector(".popup__add-link"),j=document.querySelector(".elements");function D(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=document.querySelector("#element").content,r=o.querySelector(".element").cloneNode(!0);return r.querySelector(".element__image").src=e.cardLink,r.querySelector(".element__image").alt=e.cardName,r.setAttribute("id",e.cardId),r.querySelector(".element__title").textContent=e.cardName,r.querySelector(".element__like-button").addEventListener("click",n),e.liked&&r.querySelector(".element__like-button").classList.add("element__like-button_active"),r.querySelector(".element__like-count").textContent=e.cardLikes,r.querySelector(".element__image").addEventListener("click",C),t?r.querySelector(".element__delete-button").addEventListener("click",B):r.querySelector(".element__delete-button").style.display="none",r}function B(t){var n,o=t.target.closest(".element");n=o.id,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.json()})).catch((function(e){console.log(e)})),o.remove()}function P(e){return{cardName:e.name,cardLink:e.link,cardId:e._id,cardLikes:e.likes.length,liked:!1}}function O(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}function w(e){e.querySelector(".popup__save-button").classList.add("popup__save-button_disabled"),e.querySelectorAll(".popup__error_active").forEach((function(e){e.classList.remove("popup__error_active"),e.textContent=""})),e.querySelectorAll(".popup__text-input_error_active").forEach((function(e){e.classList.remove("popup__text-input_error_active")}))}var I,J=document.querySelector(".profile__name"),G=document.querySelector(".profile__avatar"),H=document.querySelector(".profile__occupation"),z=document.querySelector(".popup__avatar-url");m.addEventListener("submit",(function(t){var n,o;t.preventDefault(),r(a),(n=_.value,o=f.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:o})}).catch((function(e){console.log(e)}))).finally(r(a)),d.textContent=_.value,p.textContent=f.value,k()})),U.addEventListener("submit",(function(t){t.preventDefault();var n,o,c={cardName:N.value,cardLink:T.value};r(i),(n=c.cardName,o=c.cardLink,fetch("".concat(e.baseUrl,"/cards/"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.json()})).catch((function(e){console.log(e)}))).then((function(e){var t=D(P(e),!0);j.append(t)})).catch((function(e){return console.log(e)})).finally(r(i)),U.reset(),g(i)})),l.addEventListener("click",(function(){w(i),E(i)})),c.addEventListener("click",(function(){_.value=d.textContent,f.value=p.textContent,E(a),w(a)})),s.addEventListener("click",(function(){return g(i)})),h.addEventListener("click",(function(){return g(v)})),u.addEventListener("click",k),q.addEventListener("click",(function(){return E(S)})),b.addEventListener("click",(function(){return g(S)})),L.addEventListener("submit",(function(t){t.preventDefault();var n,o=z.value;r(S),(n=o,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).catch((function(e){console.log(e)}))).finally(r(S)),G.src=o,g(S)})),I={formSelector:".popup__form",inputSelector:".popup__text-input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__text-input_error_active",errorClass:"popup__error_active"},Array.from(document.querySelectorAll(I.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,o,r,c){var a=Array.from(e.querySelectorAll(t)),u=e.querySelector(n);O(a,u,o),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector(".popup__error_type_".concat(t.id));t.classList.remove(n),r.textContent="",r.classList.remove(o)}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".popup__error_type_".concat(t.id));t.classList.add(n),c.textContent=r,c.classList.add(o)}(e,t,n,o,t.validationMessage)}(e,t,r,c),O(a,u,o)}))}))}(e,I.inputSelector,I.submitButtonSelector,I.inactiveButtonClass,I.inputErrorClass,I.errorClass)})),Promise.all([void t().then((function(e){G.src=e.avatar,J.textContent=e.name,H.textContent=e.about})),void fetch("".concat(e.baseUrl,"/cards/"),{method:"GET",headers:e.headers}).then((function(e){return e.json()})).catch((function(e){console.log(e)})).then((function(e){e.forEach((function(e){var n=P(e);t().then((function(t){var o;e.likes.forEach((function(e){e._id===t._id&&(n.liked=!0)})),o=t._id===e.owner._id?D(n,!0):D(n,!1),j.append(o)})).catch((function(e){console.log(e)}))}))})).catch((function(e){console.log(e)}))]).catch((function(e){return console.log(e)}))})();