(()=>{"use strict";function e(e){var t=e.querySelector(".popup__save-button");"Сохранить"===t.value?t.value="Сохранение...":t.value="Сохранить"}var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-1",headers:{authorization:"a09daf17-3aa6-4f0e-82ba-81e647b9b7db","Content-Type":"application/json"}},n=document.querySelector(".profile__edit-button"),r=document.querySelector(".popup_edit"),o=r.querySelector(".close-button"),c=document.querySelector(".profile__add-button"),a=document.querySelector(".popup_add"),u=a.querySelector(".close-button"),i=document.querySelector(".profile__name"),l=document.querySelector(".profile__occupation"),s=r.querySelector(".popup__profile-name"),d=r.querySelector(".popup__profile-about"),p=r.querySelector(".popup__form"),_=document.querySelector(".popup_image"),f=_.querySelector(".close-button"),m=document.querySelectorAll(".popup"),v=document.querySelector(".popup__edit-avatar"),y=document.querySelector(".profile__avatar-container"),h=v.querySelector(".close-button"),S=v.querySelector(".popup__form");function b(){q(r),p.reset()}function k(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)}function q(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}function L(e){var t=document.querySelector(".image-popup__image"),n=document.querySelector(".image-popup__caption");t.src=e.target.src,t.alt=e.target.alt,n.textContent=e.target.alt,k(_)}function E(e){q(e.target)}function g(e){"Escape"===e.key&&m.forEach((function(e){q(e)}))}m.forEach((function(e){e.addEventListener("click",E)}));var C=a.querySelector(".popup__form"),x=C.querySelector(".popup__add-card"),A=C.querySelector(".popup__add-link"),U=document.querySelector(".elements");function j(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.querySelector("#element").content,r=n.querySelector(".element").cloneNode(!0),o=r.querySelector(".element__image"),c=r.querySelector(".element__like-button");return o.src=e.cardLink,o.alt=e.cardName,r.setAttribute("id",e.cardId),r.querySelector(".element__title").textContent=e.cardName,c.addEventListener("click",N),e.liked&&c.classList.add("element__like-button_active"),r.querySelector(".element__like-count").textContent=e.cardLikes,o.addEventListener("click",L),t?r.querySelector(".element__delete-button").addEventListener("click",D):r.querySelector(".element__delete-button").style.display="none",r}function D(e){var n,r=e.target.closest(".element");(n=r.id,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then((function(e){if(e.ok)return e.json()}))).then((function(e){r.remove()})).catch((function(e){return console.log("Ошибка: ".concat(e))}))}function I(e){return{cardName:e.name,cardLink:e.link,cardId:e._id,cardLikes:e.likes.length,liked:!1}}function N(e){var n=e.target.closest(".element").id;e.target.classList.contains("element__like-button_active")?(e.target.classList.remove("element__like-button_active"),function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){if(e.ok)return e.json()}))}(n).then((function(e){return T(n,e.likes)}))):(e.target.classList.add("element__like-button_active"),function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){if(e.ok)return e.json()}))}(n).then((function(e){return T(n,e.likes)})))}function T(e,t){document.getElementById(e).querySelector(".element__like-count").textContent=t.length}function P(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)}function O(e){e.querySelector(".popup__save-button").classList.add("popup__save-button_disabled"),e.querySelectorAll(".popup__error_active").forEach((function(e){e.classList.remove("popup__error_active"),e.textContent=""})),e.querySelectorAll(".popup__text-input_error_active").forEach((function(e){e.classList.remove("popup__text-input_error_active")}))}var w,B=document.querySelector(".profile__name"),F=document.querySelector(".profile__avatar"),J=document.querySelector(".profile__occupation"),R=document.querySelector(".popup__avatar-url");p.addEventListener("submit",(function(n){var o,c;n.preventDefault(),e(r),(o=s.value,c=d.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:c})}).then((function(e){if(e.ok)return e.json()}))).finally(e(r)),i.textContent=s.value,l.textContent=d.value,b()})),C.addEventListener("submit",(function(n){n.preventDefault();var r,o,c={cardName:x.value,cardLink:A.value};e(a),(r=c.cardName,o=c.cardLink,fetch("".concat(t.baseUrl,"/cards/"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r,link:o})}).then((function(e){if(e.ok)return e.json()}))).then((function(e){var t=j(I(e),!0);U.prepend(t),C.reset(),q(a)})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally(e(a))})),c.addEventListener("click",(function(){O(a),k(a)})),n.addEventListener("click",(function(){s.value=i.textContent,d.value=l.textContent,k(r),O(r)})),u.addEventListener("click",(function(){return q(a)})),f.addEventListener("click",(function(){return q(_)})),o.addEventListener("click",b),y.addEventListener("click",(function(){return k(v)})),h.addEventListener("click",(function(){return q(v)})),S.addEventListener("submit",(function(n){n.preventDefault();var r,o=R.value;e(v),(r=o,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:r})}).then((function(e){if(e.ok)return e.json()}))).finally((function(){return e(v)})),F.src=o,q(v)})),w={formSelector:".popup__form",inputSelector:".popup__text-input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__text-input_error_active",errorClass:"popup__error_active"},Array.from(document.querySelectorAll(w.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,r,o,c){var a=Array.from(e.querySelectorAll(t)),u=e.querySelector(n);P(a,u,r),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,r){t.validity.valid?function(e,t,n,r){var o=e.querySelector(".popup__error_type_".concat(t.id));t.classList.remove(n),o.textContent="",o.classList.remove(r)}(e,t,n,r):function(e,t,n,r,o){var c=e.querySelector(".popup__error_type_".concat(t.id));t.classList.add(n),c.textContent=o,c.classList.add(r)}(e,t,n,r,t.validationMessage)}(e,t,o,c),P(a,u,r)}))}))}(e,w.inputSelector,w.submitButtonSelector,w.inactiveButtonClass,w.inputErrorClass,w.errorClass)})),Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{method:"GET",headers:t.headers}).then((function(e){if(e.ok)return e.json()})),fetch("".concat(t.baseUrl,"/cards/"),{method:"GET",headers:t.headers}).then((function(e){if(e.ok)return e.json()}))]).then((function(e){window.PROFILE_ID=e[0]._id;var t=e[0],n=e[1];!function(e){F.src=e.avatar,B.textContent=e.name,J.textContent=e.about}(t),n.forEach((function(e){var t,n=I(e);e.likes.forEach((function(e){e._id===PROFILE_ID&&(n.liked=!0)})),t=PROFILE_ID===e.owner._id?j(n,!0):j(n,!1),U.prepend(t)}))})).catch((function(e){return console.log(e)}))})();